---
import Base from '@/layouts/Base.astro';
import ProjectCard from '@/components/ProjectCard.astro';
import PublicationItem from '@/components/PublicationItem.astro';
import CoverGallery from '@/components/CoverGallery.astro';
import MediaTriptych from '@/components/MediaTriptych.astro';

import profile from '@/content/profile.json';
import highlights from '@/content/highlights.json';
import projects from '@/content/projects.json';
import publications from '@/content/publications.json';
import covers from '@/content/covers.json';
import featured from '@/content/featured.json';

const title = `${profile.name} — ${profile.role}`;
const description = profile.tagline;
---
<Base {title} {description} url={profile.site}>


  <section class="grid gap-8 lg:grid-cols-[2fr,1fr] items-start">
    <div class="card p-8">
      <h1 class="text-3xl font-serif font-bold tracking-tight">{profile.name}</h1>
      <p class="mt-3 text-lg text-[color:var(--muted)]">{profile.tagline}</p>
      <div class="mt-4 flex flex-wrap gap-3 text-sm">
        <a class="underline" href={profile.links.github}>GitHub</a>
        <a class="underline" href={profile.links.scholar}>Google Scholar</a>
        <a class="underline" href={profile.links.linkedin}>LinkedIn</a>
        {profile.cv && <a class="underline" href={profile.cv}>CV</a>}
        {profile.email && <a class="underline" href={`mailto:${profile.email}`}>Email</a>}
      </div>
    </div>
    <aside class="card p-6">
      <h2 class="font-semibold">At a glance</h2>
      <ul class="mt-3 space-y-2 text-sm">
        {profile.summary.map((s) => <li>• {s}</li>)}
      </ul>
    </aside>
  </section>

  <section id="projects" class="mt-12">
    <h2 class="text-2xl font-semibold">Selected Projects</h2>
    <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {projects.map((p) => <ProjectCard project={p} />)}
    </div>
  </section>


  <!-- Featured at top: matches nav link /#featured -->
  <MediaTriptych
    id="featured"
    title="Featured Media"
    covers={featured?.covers ?? []}
    video={featured?.video ?? {}}
  />

  <section id="publications" class="mt-12">
    <h2 class="text-2xl font-semibold">Publications</h2>
    <ol class="mt-4 space-y-4 list-decimal list-inside">
      {publications.map((pub) => <PublicationItem pub={pub} />)}
    </ol>
  </section>

  <!-- Journal covers gallery (kept as-is) -->
  {covers.length > 0 && <CoverGallery covers={covers} />}

  <section id="highlights" class="mt-12">
    <h2 class="text-2xl font-semibold">Highlights</h2>
    <ul class="mt-4 grid gap-4 md:grid-cols-2">
      {highlights.map((h) => (
        <li class="card p-5">
          <div class="text-sm text-[color:var(--muted)]">{h.date}</div>
          <div class="font-medium">{h.title}</div>
          <p class="text-sm mt-1">{h.description}</p>
          {h.link && <a class="text-sm underline mt-2 inline-block" href={h.link} target="_blank" rel="noopener">Details</a>}
        </li>
      ))}
    </ul>
  </section>

  <section id="contact" class="mt-12 card p-8">
    <h2 class="text-2xl font-semibold">Contact</h2>
    <p class="mt-2 text-sm">Email: <a class="underline" href={`mailto:${profile.email}`}>{profile.email}</a></p>
    <p class="text-sm">Location: {profile.location}</p>
  </section>

  <!-- Person & Publications schema (unchanged) -->
  <script type="application/ld+json" is:inline>
    {JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'Person',
      name: profile.name,
      jobTitle: profile.role,
      url: profile.site,
      email: `mailto:${profile.email}`,
      sameAs: [profile.links.github, profile.links.linkedin, profile.links.scholar]
    })}
  </script>
  <script type="application/ld+json" is:inline>
    {JSON.stringify({
      '@context': 'https://schema.org',
      '@graph': publications.map((p) => ({
        '@type': 'ScholarlyArticle',
        headline: p.title,
        author: p.authors?.split(',').map((n) => ({ '@type': 'Person', name: n.trim() })),
        url: p.url || profile.site,
        datePublished: p.year?.toString(),
        isPartOf: { '@type': 'PublicationIssue', name: p.venue }
      }))
    })}
  </script>
</Base>
